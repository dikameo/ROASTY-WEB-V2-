<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Roasty</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-2">
                    <div class="w-6 h-6 bg-black"></div>
                    <span class="text-xl font-bold">Roasty</span>
                </div>


            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-6xl w-full flex flex-col lg:flex-row items-center gap-12">
            <!-- Left Side - Image & Text -->
            <div class="flex-1 text-center lg:text-left">
                <div class="mb-12 -mt-8">
                    <h1 class="text-4xl lg:text-5xl font-bold text-gray-900 mb-4">
                        Welcome Back to<br />
                        <span class="text-orange-600">Roasty</span>
                    </h1>
                    <p class="text-lg text-gray-600">
                        Discover your perfect brew and explore our curated selection of premium coffee beans
                    </p>
                </div>
                <div class="hidden lg:block">
                    <div class="w-full h-80 rounded-2xl overflow-hidden">
                        <img src="https://lh3.googleusercontent.com/aida-public/AB6AXuDC3mlV3d2q6nh6qcY2yN3h-YI1OmJ2LsOEEKENG9_ZPqIVijM5EQwW6jOfcsNS5LlQtq0j3bs0aSzpRMpbUmxeIl28Fh9CzSzsO6tEt2j7DMykAfnt9ebNjgl8lHvBvZkApNgCTIj6HAeBRL53x_bkFdB7vqTofFMftMKYGJ_beYufEbZFdudMTI4rcMe05WdKCskDicJy8uxObphEbh2sl2Qm4PdcUPF2N2Rq4tGSVqp7R6CbIx-BAJs7N6w9iFw54jUrvyJdSS8"
                            alt="Coffee brewing" class="w-full h-full object-cover">
                    </div>
                </div>
            </div>

            <!-- Right Side - Login Form -->
            <div class="flex-1 w-full max-w-md">
                <div class="bg-white rounded-2xl shadow-xl p-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6">Login</h2>

                    <div id="errorMessage"
                        class="hidden mb-4 p-3 bg-red-50 border border-red-200 text-red-700 rounded-lg text-sm">
                        Email atau password salah!
                    </div>

                    <div id="successMessage"
                        class="hidden mb-4 p-3 bg-green-50 border border-green-200 text-green-700 rounded-lg text-sm">
                        Login berhasil! Mengalihkan...
                    </div>

                    <form id="loginForm" class="space-y-5">
                        <!-- Email -->
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                                Email
                            </label>
                            <input type="email" id="email" name="email" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent outline-none transition"
                                placeholder="nama@email.com">
                        </div>

                        <!-- Password -->
                        <div>
                            <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
                                Password
                            </label>
                            <input type="password" id="password" name="password" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent outline-none transition"
                                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        </div>

                        <!-- Remember Me & Forgot Password -->
                        <div class="flex items-center justify-between">
                            <label class="flex items-center">
                                <input type="checkbox"
                                    class="w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500">
                                <span class="ml-2 text-sm text-gray-600">Ingat saya</span>
                            </label>
                            <a href="lupapw.html" class="text-sm text-orange-600 hover:text-orange-700 font-medium">
                                Lupa password?
                            </a>
                        </div>

                        <!-- Submit Button -->
                        <button type="submit"
                            class="w-full bg-orange-600 hover:bg-orange-700 text-white font-semibold py-3 rounded-lg transition duration-200 shadow-lg hover:shadow-xl">
                            Masuk
                        </button>
                    </form>

                    <!-- Sign Up Link -->
                    <p class="mt-6 text-center text-sm text-gray-600">
                        Belum punya akun?
                        <a href="register.html" class="text-orange-600 hover:text-orange-700 font-medium">
                            Daftar sekarang
                        </a>
                    </p>
                </div>
            </div>
        </div>
    </main>

    <script src="config.js"></script>
    <!-- Optional: Uncomment untuk debugging/testing -->
    <!-- <script src="login-verification.js"></script> -->
    <script>
        // Mengambil nilai dari config.js
        const API_URL = CONFIG.API_BASE_URL;
        console.log('API_URL:', API_URL);

        async function login(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            console.log('üîê Login attempt with email:', email);

            // Reset pesan
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');

            if (errorMessage) errorMessage.classList.add('hidden');
            if (successMessage) successMessage.classList.add('hidden');

            try {
                console.log('üì° Sending login request to:', `${API_URL}/login`);

                const res = await fetch(`${API_URL}/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });

                console.log('üìä Response status:', res.status);

                const data = await res.json();
                console.log('üì¶ Response data:', data);

                if (!res.ok) {
                    throw new Error(data.message || 'Login gagal');
                }

                // Validasi response
                if (!data.data || !data.data.token) {
                    throw new Error('Response API tidak valid: token tidak ditemukan');
                }

                if (!data.data.user) {
                    throw new Error('Response API tidak valid: user data tidak ditemukan');
                }

                const user = data.data.user;
                console.log('üë§ User data received:', {
                    id: user.id,
                    name: user.name,
                    email: user.email,
                    role: user.role
                });

                // Validasi role field
                if (!user.role) {
                    throw new Error('Role field tidak ditemukan di response API');
                }

                // 1. Simpan Token
                localStorage.setItem('token', data.data.token);
                console.log('‚úÖ Token disimpan ke localStorage');

                // 2. Simpan User Info
                localStorage.setItem('user', JSON.stringify(user));
                console.log('‚úÖ User data disimpan ke localStorage');
                console.log('üë§ User role:', user.role);

                // 3. Tampilkan success message
                if (successMessage) {
                    successMessage.classList.remove('hidden');
                    successMessage.textContent = 'Login berhasil! Mengalihkan...';
                }

                // 4. Redirect berdasarkan role
                setTimeout(() => {
                    console.log('üîÑ Redirect berdasarkan role:', user.role);

                    if (user.role === 'admin') {
                        console.log('üë®‚Äçüíº Admin login detected - redirecting to admin_dashboard.html');
                        window.location.href = 'admin_dashboard.html';
                    } else {
                        console.log('üë§ Regular user login detected - redirecting to Halaman.beranda.html');
                        window.location.href = 'Halaman.beranda.html';
                    }
                }, 1000);

            } catch (err) {
                console.error('‚ùå Login error:', err.message);
                console.error('Error details:', err);

                if (errorMessage) {
                    errorMessage.classList.remove('hidden');
                    errorMessage.textContent = err.message;
                } else {
                    alert(err.message);
                }
            }
        }

        // Bind event listener
        const loginForm = document.getElementById('loginForm');
        if (loginForm) {
            loginForm.addEventListener('submit', login);
        } else {
            console.error('‚ùå Login form not found!');
        }
    </script>


</body>

</html>
